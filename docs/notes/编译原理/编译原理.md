## 编译原理

> 2023 - 2024 春夏

### Introduction

> 2024.2.29

`compiler`: 一个将一种语言翻译为另一种语言的程序 (语言与计算机相关)。

<img src="./编译原理.assets/image-20240229105604094.png" alt="image-20240229105604094" style="zoom:25%;" />

#### Typical Workflow of a Compiler

编译器的工作阶段通常如下：分为**前、中、后**三端

<img src="./编译原理.assets/image-20240229105635243.png" alt="image-20240229105635243" style="zoom:25%;" />

+ **词法分析** (Lexical Analysis): String $\rightarrow$ token sequence (记号序列)，删除不必要的部分。通常使用正则表达式定义 (例如 `rm 2024*`)，用于匹配不同的 token。

+ **语法分析** (Syntactic Analysis): 将记号序列解析为某种语法结构 (如语法树)。

+ **语义分析** (Semantic Analysis): 分析语法树节点的属性信息等。得到符号表等。

  <img src="./编译原理.assets/image-20240229111638563.png" alt="image-20240229111638563" style="zoom:25%;" />

+ **中间代码生成** (IR): 源语言与目标语言的桥梁。(三地址: 每个表达式中至多一个操作符两个操作数)

  <img src="./编译原理.assets/image-20240229111840556.png" alt="image-20240229111840556" style="zoom:25%;" />
  
+ **基于中间表示的优化 ** (机器无关代码优化): 对中间代码进行优化和变换，降低执行时间，减少资源消耗。

  <img src="./编译原理.assets/image-20240229112209757.png" alt="image-20240229112209757" style="zoom:25%;" />

+ **后端 - 目标代码生成**: 把中间代码翻译为目标语言，涉及到**指令选择**、**寄存器分配**、**指令调度**等。

  <img src="./编译原理.assets/image-20240229112502564.png" alt="image-20240229112502564" style="zoom:25%;" />

#### Tiger 编译器

<img src="./编译原理.assets/image-20240229112935252.png" alt="image-20240229112935252" style="zoom:33%;" />

+ **AST** (抽象语法树): 经过语法分析 + "Parsing Actions" 生成。
+ **IR Tree** (树型中间表示): 语义分析之后按照一定规则生成。进行了归一化 (Canonicalized) 的操作。
+ **Control Flow Analysis** (控制流分析): 判断分支语句的执行路径 (可以去除不可达的路径)。
  + **CFG** (Control Flow Graph) (控制流图): 方便进行数据流分析–如活跃变量分析 (Liveness Analysis)。
+ **Interference Graph** (冲突图): 从活跃变量分析的结果构造，用于指导寄存器分配。